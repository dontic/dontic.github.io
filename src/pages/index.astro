---
// index.astro

import PageLayout from '~/layouts/PageLayout.astro';

import Image from 'astro/components/Image.astro';
import avatarImage from '~/assets/images/avatar.jpeg';
import Socials from '~/components/common/Socials.astro';
---

<PageLayout> Hello </PageLayout>

<script>
  // Redirect to Spanish version if user lands directly and browser language is Spanish
  (function () {
    // Check if this is a direct visit (not from same site)
    const referrer = document.referrer;
    const currentDomain = window.location.hostname;
    const isDirectVisit = !referrer || !referrer.includes(currentDomain);

    // Check if we've already done this redirect in this session
    const hasRedirected = sessionStorage.getItem('locale-redirect-checked');

    if (isDirectVisit && !hasRedirected) {
      // Get browser language preference
      const browserLang = navigator.language || navigator.languages?.[0];

      // Check if Spanish is preferred (es, es-ES, es-MX, etc.)
      if (browserLang && browserLang.toLowerCase().startsWith('es')) {
        // Mark that we've checked to avoid redirect loops
        sessionStorage.setItem('locale-redirect-checked', 'true');
        // Redirect to Spanish version
        window.location.href = '/es/';
      } else {
        // Mark as checked even if not redirecting
        sessionStorage.setItem('locale-redirect-checked', 'true');
      }
    }
  })();
</script>
